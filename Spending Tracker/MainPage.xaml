<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Spending_Tracker.MainPage"
             Title="Cheltuieli">

    <Grid RowDefinitions="Auto,Auto,Auto,*,Auto" Padding="10">
        
        <!-- Header with total -->
        <Frame Grid.Row="0" BackgroundColor="#512BD4" Padding="20" Margin="5" CornerRadius="10">
            <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                <Image Grid.Column="0"
                       Source="money_bag.png"
                       HeightRequest="60"
                       WidthRequest="60"
                       Aspect="AspectFit"
                       VerticalOptions="Center"/>
                <VerticalStackLayout Grid.Column="1">
                    <Label Text="Total Cheltuieli Luna Curentă" 
                           TextColor="White" 
                           FontSize="16" 
                           HorizontalOptions="Center"/>
                    <Label x:Name="TotalLabel" 
                           Text="0.00 RON" 
                           TextColor="White" 
                           FontSize="32" 
                           FontAttributes="Bold"
                           HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Grid>
        </Frame>

        <!-- Filter controls -->
        <Frame Grid.Row="1" Padding="10" Margin="5" CornerRadius="10">
            <Grid ColumnDefinitions="*,*,Auto" ColumnSpacing="10">
                <DatePicker x:Name="StartDatePicker" 
                            Grid.Column="0" 
                            Date="{Binding StartDate}"
                            DateSelected="OnFilterChanged"/>
                <DatePicker x:Name="EndDatePicker" 
                            Grid.Column="1"
                            Date="{Binding EndDate}"
                            DateSelected="OnFilterChanged"/>
                <Button Grid.Column="2" 
                        Text="Reset" 
                        Clicked="OnResetFilter"
                        WidthRequest="80"/>
            </Grid>
        </Frame>

        <!-- Category filter -->
        <Frame Grid.Row="2" Padding="10" Margin="5" CornerRadius="10">
            <HorizontalStackLayout Spacing="10">
                <Label Text="Categorie:" VerticalOptions="Center" FontSize="16"/>
                <Picker x:Name="CategoryPicker" 
                        Title="Toate categoriile"
                        SelectedIndexChanged="OnFilterChanged"
                        HorizontalOptions="FillAndExpand"/>
            </HorizontalStackLayout>
        </Frame>

        <!-- ListView with expenses -->
        <ListView x:Name="ExpensesListView" 
                  Grid.Row="3"
                  Margin="5"
                  ItemTapped="OnExpenseSelected"
                  HasUnevenRows="True">
            <ListView.Header>
                <Label Text="Istoric Cheltuieli" 
                       FontSize="20" 
                       FontAttributes="Bold"
                       Margin="10,10,10,5"/>
            </ListView.Header>
            <ListView.ItemTemplate>
                <DataTemplate>
                    <ViewCell>
                        <SwipeView>
                            <SwipeView.RightItems>
                                <SwipeItems>
                                    <SwipeItem Text="Șterge" 
                                               BackgroundColor="Red"
                                               Clicked="OnDeleteExpense"/>
                                </SwipeItems>
                            </SwipeView.RightItems>
                            <Frame Padding="10" Margin="5" CornerRadius="10">
                                <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto">
                                    <BoxView Grid.Column="0" 
                                             Grid.RowSpan="2"
                                             WidthRequest="5" 
                                             Color="{Binding CategoryColor}"
                                             Margin="0,0,10,0"/>
                                    <Label Grid.Column="1" 
                                           Grid.Row="0"
                                           Text="{Binding Description}" 
                                           FontSize="16" 
                                           FontAttributes="Bold"/>
                                    <Label Grid.Column="1" 
                                           Grid.Row="1"
                                           Text="{Binding Category}" 
                                           FontSize="12" 
                                           TextColor="Gray"/>
                                    <Label Grid.Column="2" 
                                           Grid.Row="0"
                                           Text="{Binding AmountDisplay}" 
                                           FontSize="18" 
                                           FontAttributes="Bold"
                                           TextColor="#512BD4"
                                           HorizontalOptions="End"/>
                                    <Label Grid.Column="2" 
                                           Grid.Row="1"
                                           Text="{Binding DateDisplay}" 
                                           FontSize="11" 
                                           TextColor="Gray"
                                           HorizontalOptions="End"/>
                                </Grid>
                            </Frame>
                        </SwipeView>
                    </ViewCell>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- Add button -->
        <Button Grid.Row="4" 
                Text="+ Adaugă Cheltuială" 
                Clicked="OnAddExpense"
                BackgroundColor="#512BD4"
                TextColor="White"
                Margin="5"
                HeightRequest="50"
                CornerRadius="25"
                FontSize="18"
                FontAttributes="Bold"/>
    </Grid>

</ContentPage>
